#- module: StdInHandler
#  receivers:
#    - SyslogMessageParser
    
- module: TcpServerThreaded
  configuration:
    interface: localhost
    port: 5152
  receivers: 
    - SyslogMessageParser

- module: SyslogMessageParser
  configuration:
    mark-on-success: syslog-message
    field_extraction_patterns:
      httpd_access_log: '(?P<log_timestamp>\w+\s+\d+\s+\d+:\d+:\d+)\s+(?P<host>[\w\-\._]+)\s+(apache2|nginx): httpd\[(?P<pid>\d+)\]\s+(?P<virtual_host_name>.*)\s+(?P<remote_ip>\d+\.\d+\.\d+\.\d+)\s+(?P<request_time>[\d\.]+)\s+\"(?P<http_method>GET|POST)\s+(?P<uri>.*)\"\s+(?P<http_status>-|\d+)\s+(?P<bytes_sent>-|\d+)\s+(?P<cookie_sid>\S+)\s+(?P<cookie_unique_id>\S+)\s+\"(?P<referer>.*)\"\s+\"(?P<user_agent>.*)\"'
      httpd_log_phperrors: '(?P<log_timestamp>\w+\s+\d+\s+\d+:\d+:\d+)\s+(?P<host>[\w\-\._]+)\s+httpd\[(?P<pid>\d+)\]:?\s(\[(?P<status>\w+)\]\s+)?\[client\s+(?P<remote_ip>\d+\.\d+\.\d+\.\d+)\]\s+PHP (?P<php_error_type>Warning|Notice|Fatal error):\s+(?P<php_error_message>.*)'
      php_fpm_log_errors: '(?P<log_timestamp>\w+\s+\d+\s+\d+:\d+:\d+)\s+(?P<host>[\w\-\._]+)\s+php-fpm\[(?P<pid>\d+)\]:?\s\[(?P<php_error_type>\w+)\]\s+\[pool\s(?P<php_fpm_poolname>[\w\-\._\s]+)\]\s+(?P<php_error_message>.*)'
      httpd_log_errors: '(?P<log_timestamp>\w+\s+\d+\s+\d+:\d+:\d+)\s+(?P<host>[\w\-\._]+)\s+httpd\[(?P<pid>\d+)\]:?\s\[(?P<status>\w+)\]\s+\[client\s+(?P<remote_ip>\d+\.\d+\.\d+\.\d+)\]\s+(?P<httpd_error_message>.*)'
      daemontools: '(?P<log_timestamp>\w+\s+\d+\s+\d+:\d+:\d+)\s+(?P<host>[\w\-\._]+)\s+daemontools\.(?P<service_name>\w+):\s+(?P<log_message>.*)'
  receivers:
    - AddTimeStamp
            
- module: AddTimeStamp
  receivers:
    - AddGeoInfo

- module: AddGeoInfo
  configuration: /usr/share/GeoIP/GeoIP.dat
  receivers:
    - MessageAggregator
    
- module: MessageAggregator
  configuration:
    store_data_interval: 25
  receivers: 
    - ElasticSearchStorageHandler
    
- module: ElasticSearchStorageHandler
  pool-size: 4
  configuration:
    host: localhost:9200
    index_prefix: test-
    field_types: 
      block_status: Integer
      block_threshold: Integer
      bytes_sent: Integer
      flow_count: Integer
      http_status: Integer
      octets: Integer
      pid: Integer
      remote_port: Integer
      request_time: Integer
      request_size: Integer

- module: Statistics
  configuration:
    print_regex_statistics_at_message_count: 1000
    regexStatistics: True
    receiveRateStatistics: True

- module: StdOutHandler
- module: DevNullSink

#- module: TcpServerTwisted
#  configuration:
#    TCP: 5152
#  receivers: 
#    - SyslogMessageParser

